<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

  <title>Class: Setup::Uninstaller</title>

  
    <link rel="SHORTCUT ICON" href="../../assets/icon/class.png">
  

  <link type="text/css" rel="stylesheet" href="../../assets/rdoc.css" media="screen" />
  <link type="text/css" rel="stylesheet" href="../../assets/highlight/styles/github.css" title="GitHub" />

  <script type="text/javascript" charset="utf-8" src="../../assets/jquery.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../assets/highlight/highlight.pack.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../assets/quicksearch.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../assets/main.js"></script>

  <script type="text/javascript">
    $(document).ready( function() {
      hookHighlightSyntax();
	    hookSourceViews();
	    hookDebuggingToggle();
	    hookQuickSearch();
	    highlightLocationTarget();

	    $('ul.link-list a').bind("click", highlightClickTarget);
    });
  </script>
</head>
<body class="class">
<div id="main">

  <div class="head">
    <h1>
      
        <img src="../../assets/icon/class.png" align="absmiddle">&nbsp;
      
      <a href="../../index.html">Setup</a>&nbsp;
      <a href="/">Setup::Uninstaller</a>
    </h1>
  </div>

  <div id="metadata">
    <div id="project-metadata">

      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li class="file"><a href="../../files/lib/setup/uninstaller_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/setup/uninstaller.rb">lib/setup/uninstaller.rb</a></li>
          
          </ul>
        </div>
      </div>

      <!-- What about Git info, or Hg info? This seems almost silly, albeit kind of cool. -->
      <!-- TODO: generalize this for all SCMs -->

      
    </div>

    <div id="class-metadata">

      <!-- Parent Class -->
      
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        <ul>
          
          <li class="class">Base</li>
          
        </ul>
      </div>
      

      <!-- Namespace Contents -->
      

      <!-- Method Quickref -->
      
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
            
            <li class="method">
              <a href="#M000061">#paths</a>
            </li>
          
            
            <li class="method">
              <a href="#M000058">#uninstall</a>
            </li>
          
        </ul>
      </div>
      

      <!-- Included Modules -->
      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Information</h3>
        <ul>
        
          <li class="file"><a href="../../files/SetupConfig.html">SetupConfig</a></li>
        
          <li class="file"><a href="../../files/InstalledFiles.html">InstalledFiles</a></li>
        
          <li class="file"><a href="../../files/HISTORY.html">HISTORY</a></li>
        
          <li class="file"><a href="../../files/COPYING.html">COPYING</a></li>
        
          <li class="file"><a href="../../files/README_rdoc.html">README.rdoc</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class Index
          <span class="search-toggle"><img src="../../assets/icon/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <!-- classpage.html : classes -->
        <ul class="link-list">
        
          <li class="module"><a href="../../classes/Setup.html">Setup</a></li>
        
          <li class="class"><a href="../../classes/Setup/Base.html">Setup::Base</a></li>
        
          <li class="class"><a href="../../classes/Setup/Command.html">Setup::Command</a></li>
        
          <li class="class"><a href="../../classes/Setup/Compiler.html">Setup::Compiler</a></li>
        
          <li class="class"><a href="../../classes/Setup/Configuration.html">Setup::Configuration</a></li>
        
          <li class="class"><a href="../../classes/Setup/Documentor.html">Setup::Documentor</a></li>
        
          <li class="class"><a href="../../classes/Setup/Error.html">Setup::Error</a></li>
        
          <li class="class"><a href="../../classes/Setup/Installer.html">Setup::Installer</a></li>
        
          <li class="class"><a href="../../classes/Setup/Installer/Shebang.html">Setup::Installer::Shebang</a></li>
        
          <li class="class"><a href="../../classes/Setup/Project.html">Setup::Project</a></li>
        
          <li class="class"><a href="../../classes/Setup/Session.html">Setup::Session</a></li>
        
          <li class="class"><a href="../../classes/Setup/Tester.html">Setup::Tester</a></li>
        
          <li class="class"><a href="../../classes/Setup/Uninstaller.html">Setup::Uninstaller</a></li>
        
          <li class="class"><a href="../../classes/Object.html">Object</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>
    </div>

    <div id="validator-badges">
      
      <div style="float: right; margin-right: 5px;">
        <a href="http://validator.w3.org/check/referer"><img src="../../assets/icon/check.png" alt="[Validate]" height="16" width="16" /></a>
      </div>
      Generated with <a href="http://github.com/proutils/webri">WebRI Redfish</a> 1.1
      <br/><br/>
    </div>
  </div>

  <div id="documentation">

    <div id="description">
      
        <h1>Uninstaller</h1>
      

      <p>
TODO: It would be nice to improve this such that files to be removed are
taken out of the list of directories that may be removed when they become
empty. That way the end-user can see an exact list before commiting to the
uninstall (using &#8212;force).
</p>

    </div>

    <!-- Constants -->
    

    <!-- Attributes -->
    

    <!-- Methods -->
    
    <div id="public-instance-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="uninstall-method" class="method-detail ">
        <a name="M000058"></a>

        <div class="method-heading">
        
          <span class="method-name">uninstall</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          
          

          
          <div class="method-source-code"
            id="uninstall-source">
<pre>
<span class="ruby-comment cmt"># File lib/setup/uninstaller.rb, line 14</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">uninstall</span>
      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-constant">INSTALL_RECORD</span>)

      <span class="ruby-identifier">files</span> = []
      <span class="ruby-identifier">dirs</span>  = []

      <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">dirs</span>  <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">path</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dir?</span>(<span class="ruby-identifier">path</span>)
        <span class="ruby-identifier">files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">path</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">path</span>)
      <span class="ruby-keyword kw">end</span>

      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">dirs</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">files</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-identifier">io</span>.<span class="ruby-identifier">outs</span> <span class="ruby-value str">&quot;Nothing to remove.&quot;</span>
        <span class="ruby-keyword kw">return</span>
      <span class="ruby-keyword kw">end</span>

      <span class="ruby-identifier">files</span>.<span class="ruby-identifier">sort!</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">size</span> }
      <span class="ruby-identifier">dirs</span>.<span class="ruby-identifier">sort!</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">size</span> }

      <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">force?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">trial?</span>
        <span class="ruby-identifier">puts</span> (<span class="ruby-identifier">files</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">dirs</span>).<span class="ruby-identifier">collect</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{f}&quot;</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
        <span class="ruby-identifier">puts</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Must use --force option to remove these files and directories that become empty.&quot;</span>
        <span class="ruby-keyword kw">return</span>
      <span class="ruby-keyword kw">end</span>

      <span class="ruby-identifier">files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">rm_f</span>(<span class="ruby-identifier">file</span>)
      <span class="ruby-keyword kw">end</span>

      <span class="ruby-identifier">dirs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dir</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">entries</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">entries</span>(<span class="ruby-identifier">dir</span>)
        <span class="ruby-identifier">entries</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">'.'</span>)
        <span class="ruby-identifier">entries</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">'..'</span>)

        <span class="ruby-comment cmt">#begin</span>
          <span class="ruby-identifier">rmdir</span>(<span class="ruby-identifier">dir</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">entries</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-comment cmt">#rescue Errno::ENOTEMPTY</span>
        <span class="ruby-comment cmt">#  io.puts &quot;not empty -- #{dir}&quot;</span>
        <span class="ruby-comment cmt">#end</span>
      <span class="ruby-keyword kw">end</span>

      <span class="ruby-identifier">rm_f</span>(<span class="ruby-constant">INSTALL_RECORD</span>)
    <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
    </div>
  
    <div id="private-instance-method-details" class="method-section section">
      <h3 class="section-header">Private Instance Methods</h3>

    
      <div id="paths-method" class="method-detail ">
        <a name="M000061"></a>

        <div class="method-heading">
        
          <span class="method-name">paths</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
path list from install record
</p>
          

          
          <div class="method-source-code"
            id="paths-source">
<pre>
<span class="ruby-comment cmt"># File lib/setup/uninstaller.rb, line 62</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">paths</span>
      <span class="ruby-ivar">@paths</span> <span class="ruby-operator">||=</span> (
        <span class="ruby-identifier">lines</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">INSTALL_RECORD</span>).<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/\s*\n/</span>)
        <span class="ruby-identifier">lines</span> = <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">strip</span> }
        <span class="ruby-identifier">lines</span> = <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">uniq</span>
        <span class="ruby-identifier">lines</span> = <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">reject</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">empty?</span> }       <span class="ruby-comment cmt"># skip blank lines</span>
        <span class="ruby-identifier">lines</span> = <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">reject</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-identifier">line</span>[<span class="ruby-value">0</span>,<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">'#'</span> }  <span class="ruby-comment cmt"># skip blank lines</span>
        <span class="ruby-identifier">lines</span>
      )
    <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
    </div>
  

  </div>


  <div id="rdoc-debugging-section-dump" class="debugging-section">
  
    <p>Disabled; run with --debug to generate this.</p>
  
  </div>

</main>
</body>
</html>

